---
- hosts: localhost
  gather_facts: no
  connection: local
  vars_files:
    - vars.yml
  pre_tasks:
    - shell: which python 
      ignore_errors: yes
      register: docker_py
    - debug: 
        var: docker_py
  roles:
    - role: chrismeyersfsu.provision_docker
      provision_docker_use_docker_connection: true

- hosts: tester
  vars_files:
    - vars.yml
  roles:
    - role: rename-database
      swap_db: yes

  post_tasks:
    - name: Check for existence of old target db
      shell: "{{ psql_cnxn }} -lqt | cut -d '|' -f 1"
      register: test_db_names
    
    - debug:
        var: test_db_names

    - assert:
        that: "new_target_name in test_db_names.stdout"